````markdown
---
description: 從互動或提供的原則輸入建立或更新專案憲章，確保所有相依模板保持同步。
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，您**必須**考慮使用者輸入（如果不為空）。

## 大綱

您正在更新位於 `/memory/constitution.md` 的專案憲章。此檔案是一個包含方括號中佔位符權杖的模板（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。您的工作是 (a) 收集/推導具體值，(b) 精確填入模板，以及 (c) 在相依產物之間傳播任何修正。

遵循此執行流程：

1. 載入位於 `/memory/constitution.md` 的現有憲章範本。
   - 識別 `[ALL_CAPS_IDENTIFIER]` 形式的每個佔位符權杖。
   **重要**：使用者可能需要比範本中使用的原則更少或更多的原則。如果指定了數字，請尊重這一點 - 遵循一般範本。您將相應地更新文件。

2. 收集/推導佔位符的值：
   - 如果使用者輸入（對話）提供值，請使用它。
   - 否則從現有儲存庫內容推斷（README、文件、先前憲章版本如果已嵌入）。
   - 對於治理日期：`RATIFICATION_DATE` 是原始採用日期（如果未知則詢問或標記 TODO），`LAST_AMENDED_DATE` 是今天（如果進行了變更），否則保持先前的。
   - `CONSTITUTION_VERSION` 必須根據語義版本規則遞增：
     * 主要：向後不相容的治理/原則移除或重新定義。
     * 次要：新增原則/區段或實質性擴展指引。
     * 修補：澄清、措辭、錯字修正、非語義細化。
   - 如果版本升級類型模糊，在最終確定前提出理由。

3. 起草更新的憲章內容：
   - 用具體文字替換每個佔位符（不留方括號權杖，除非專案選擇尚未定義的故意保留範本槽位——明確證明任何剩餘的）。
   - 保持標題層次結構，一旦替換，註釋可以移除，除非它們仍然添加澄清指引。
   - 確保每個原則區段：簡潔的名稱行、段落（或項目符號清單）捕捉不可協商的規則、明確的理由（如果不明顯）。
   - 確保治理區段列出修正程序、版本政策和合規審查期望。

4. 一致性傳播檢查清單（將先前檢查清單轉換為主動驗證）：
   - 讀取 `/templates/plan-template.md` 並確保任何「憲章檢查」或規則與更新的原則一致。
   - 讀取 `/templates/spec-template.md` 進行範圍/需求對齊——如果憲章添加/移除強制區段或約束，則更新。
   - 讀取 `/templates/tasks-template.md` 並確保任務分類反映新的或移除的原則驅動任務類型（例如，可觀測性、版本控制、測試紀律）。
   - 讀取 `/templates/commands/*.md` 中的每個命令檔案（包括這個）以驗證當需要通用指引時沒有過時的參考（僅特定代理名稱如 CLAUDE）。
   - 讀取任何運行時指引文件（例如，`README.md`、`docs/quickstart.md` 或代理特定指引檔案如果存在）。更新對已變更原則的參考。

5. 產生同步影響報告（更新後在憲章檔案頂部前置作為 HTML 註釋）：
   - 版本變更：舊 → 新
   - 修改原則清單（如果重新命名，舊標題 → 新標題）
   - 新增區段
   - 移除區段
   - 需要更新的範本（✅ 已更新 / ⚠ 待處理）及檔案路徑
   - 如果任何佔位符故意延遲，後續 TODO。

6. 最終輸出前驗證：
   - 沒有剩餘的未解釋方括號權杖。
   - 版本行與報告匹配。
   - 日期 ISO 格式 YYYY-MM-DD。
   - 原則是宣告式的、可測試的，且沒有模糊語言（「應該」→ 在適當時用 MUST/SHOULD 理由替換）。

7. 將完成的憲章寫回 `/memory/constitution.md`（覆寫）。

8. 向使用者輸出最終摘要：
   - 新版本和升級理由。
   - 任何標記為手動後續的檔案。
   - 建議的提交訊息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式與風格需求：
- 使用與範本完全相同的 Markdown 標題（不要降級/升級層級）。
- 換行長理由行以保持可讀性（理想情況下 <100 字符），但不要用尷尬的斷行硬性執行。
- 區段間保持單空行。
- 避免尾隨空白。

如果使用者提供部分更新（例如，只有一個原則修訂），仍然執行驗證和版本決策步驟。

如果關鍵資訊遺失（例如，批准日期真的未知），插入 `TODO(<FIELD_NAME>): explanation` 並在延遲項目下的同步影響報告中包含。

不要建立新範本；始終操作現有的 `/memory/constitution.md` 檔案。
